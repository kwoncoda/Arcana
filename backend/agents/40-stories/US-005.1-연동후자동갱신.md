# 외부 도구 연동 직후 자동 지식 베이스 갱신 시나리오
**문서 버전:** 1.0  
**작성일:** 2025-02-11  

---

## 1) 개요
사용자가 Notion 또는 Google Drive OAuth 인증을 마치고 대시보드로 돌아오면, 연동 상태를 보여주는 동시에 지식 베이스 갱신을 **자동으로** 시작한다. 갱신이 진행되는 동안에는 전면 오버레이를 띄워 추가 클릭을 막고, 완료/실패 여부를 상단 상태 메시지로 안내한다.

## 2) 사전 조건
- 사용자가 로그인된 상태에서 Notion/Google Drive OAuth 플로우를 진행한다.
- 백엔드 `/api/notion/oauth/callback` 또는 `/api/google-drive/oauth/callback` 호출이 성공해 연동 토큰을 확보한 상태이다.

## 3) 사용자 흐름
1. OAuth 콜백 페이지에서 연동 성공 후 대시보드(`/dashboard`)로 리다이렉션할 때 `triggerKnowledgeRefresh` 플래그와 연동 성공 여부를 `location.state`로 전달한다.
2. 대시보드가 로드되면 연동 성공 메시지를 표시하고, 전달된 플래그를 감지해 지식 베이스 갱신 루틴을 즉시 실행한다.
3. 갱신 중에는 전 화면 로딩 오버레이가 표시되어 사용자의 추가 클릭을 차단한다.
4. 모든 연결된 데이터 소스 갱신이 끝나면 결과 메시지를 상단 상태 바에 노출한다. 인증 만료나 일부 실패가 발생하면 해당 사유를 표시하고 버튼이 다시 활성화된다.

## 4) 예외/오류 처리
- **토큰 만료:** 자동 갱신 중 401 응답이 발생하면 토큰을 정리하고 로그인 페이지로 이동한다.
- **동시 요청 방지:** 갱신이 진행 중일 때는 버튼이 비활성화되고 오버레이로 추가 입력이 막힌다.
- **부분 실패:** 일부 데이터 소스가 실패하면 실패 메시지를 조합해 안내하며, 사용자가 다시 시도할 수 있도록 버튼을 복구한다.

## 5) 기대 효과
- 연동 완료 직후 별도 클릭 없이 최신 데이터가 자동으로 적재되어 사용자가 바로 검색을 시도할 수 있다.
- 전면 오버레이로 진행 상태를 명확히 전달하고, 불필요한 중복 요청이나 UI 오조작을 방지한다.
