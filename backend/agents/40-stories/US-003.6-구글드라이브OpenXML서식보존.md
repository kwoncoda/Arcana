# Google Drive OpenXML 서식 보존 시나리오

## 1) 개요
Google Drive 데이터 소스에서 Word 계열 문서를 동기화할 때, 문서의 OpenXML 태그를 함께 보존해 향후 동일한 서식으로 재생성할 수 있도록 한다. `/google-drive/files/pull` 호출 시 추출된 `word/document.xml`과 저장 경로가 JSONL/Document 메타데이터로 전달되어야 한다.

---

## 2) 선행 조건
- 사용자는 Google Drive 데이터 소스에 연결되어 있고 액세스 토큰이 유효하다.
- 워크스페이스 스토리지가 준비되어 있으며 `googledrive/pdf` 경로에 파일 저장이 가능하다.
- 동기화할 파일이 Google Docs 또는 DOCX 형식으로 존재한다.

---

## 3) 기대 시나리오
1. 사용자가 `/google-drive/files/pull` 엔드포인트를 호출한다.
2. 백엔드는 대상 파일을 DOCX(OpenXML)로 내보내거나 그대로 다운로드하여 워크스페이스에 저장한다.
3. 저장된 DOCX에서 `word/document.xml`을 추출하고 원본 XML 문자열을 `structured_text`로 보존한다.
4. XML은 `_xml_to_plain_text` 유틸리티로 평문이 파생되어 RAG 청크의 `plain_text`/`formatted_text`로 사용된다.
5. JSONL 각 레코드와 LangChain `Document` 메타데이터에는 `file_path`, `structured_format`, `structured_text`가 포함되어 향후 문서 재생성에 활용된다.
6. 응답 본문 `files` 항목 역시 OpenXML 파일 여부와 저장 경로를 노출한다.

---

## 4) 완료 조건
- 동기화 결과 JSONL/메타데이터에서 OpenXML XML 문자열을 확인할 수 있다.
- RAG 검색 시 반환되는 메타데이터에 `structured_text`와 `structured_format`이 포함된다.
- 기존 PDF 전용 동기화 플로우와 충돌 없이 작동한다.