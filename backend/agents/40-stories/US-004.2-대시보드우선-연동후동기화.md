# 데이터 소스 연동 후 대시보드 우선 전환 및 후속 동기화 시나리오
**문서 버전:** 1.0
**작성일:** 2025-02-27 00:00:00 KST

---

## 1) 개요
OAuth 연동 완료 직후에는 RAG 적재를 기다리지 않고 곧바로 메인 대시보드로 이동한 뒤, 대시보드에서 데이터 소스 동기화를 수행하며 전면 로딩 오버레이로 사용자 입력을 잠시 차단하는 흐름을 정의합니다.

---

## 2) 전제 조건
- 사용자가 로그인된 상태에서 Notion 또는 Google Drive OAuth 인증을 완료한다.
- 백엔드 콜백이 토큰 교환 및 자격 증명 저장까지 성공적으로 마친다.

---

## 3) 기본 흐름
1. **OAuth 콜백 처리**
   - `/notion/oauth/callback` 또는 `/google-drive/oauth/callback`에서 토큰을 교환한 후, 동기화 트리거 정보(`triggerSyncSources`, `syncOverlayMessage`)를 상태로 담아 `/dashboard`로 이동한다.
2. **대시보드 진입**
   - 대시보드는 전달된 상태를 읽어 연동 성공 배너를 표시하고, 지정된 데이터 소스에 대해 자동 동기화를 시작한다.
   - 동기화 동안 전체 화면 오버레이가 나타나 다른 클릭/입력을 차단한다.
3. **동기화 수행**
   - 연결된(또는 지정된) 데이터 소스만 필터링해 `/api/notion/pages/pull` 또는 `/api/google-drive/files/pull` 호출을 진행한다.
   - 완료/부분 실패/권한 만료 여부에 따라 알림 메시지를 업데이트한다.
4. **수동 갱신**
   - 사용자가 “지식 베이스 갱신” 버튼을 누르면 동일한 오버레이 UI로 모든 연결된 소스를 갱신하며, 진행 상태 메시지를 표시한다.

---

## 4) 예외 흐름
- **연결된 소스 없음**: 자동/수동 동기화 모두 “연결된 데이터 소스가 없습니다” 경고를 표시하고 즉시 종료한다.
- **인증 만료**: 동기화 중 401 응답 시 토큰을 정리하고 로그인 페이지로 이동시키며, 실패 메시지를 안내한다.
- **기타 실패**: 알 수 없는 오류는 실패 메시지에 상세 원인을 포함해 사용자에게 전달한다.

---

## 5) UI/UX 요구사항
- 동기화가 진행되는 동안 전면 로딩 오버레이로 다른 인터랙션을 차단한다.
- 자동/수동 갱신 모두 동일한 오버레이와 상태 메시지 포맷을 사용하여 일관성을 유지한다.
