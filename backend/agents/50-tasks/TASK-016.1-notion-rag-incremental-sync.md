---
id: TASK-0016.1
type: task
title: 노션 RAG 증분 동기화 기록
status: in-progress
owner: backend
updated: 2025-10-29
---

## 개요
노션 페이지를 RAG 파이프라인에 동기화하는 과정에서 불필요한 전체 재색인을 피하고, 현지 시간대와 노션이 제공하는 UTC 타임스탬프 간의 차이로 인해 발생하는 누락을 방지하기 위한 개선 사항을 정리한다.

## 변경 내역
- Notion Pull 모듈이 마지막 동기화 이후 갱신된 페이지만 필터링하도록 페이지 수집기를 개선해, 기존 백터 DB를 비우지 않고도 업데이트가 가능하도록 했다.
- Chroma 기반 RAG 저장소에서 기존 페이지의 문서 ID를 재사용하며, 페이지 단위로 교체/통계 정보를 제공하는 헬퍼 함수를 추가했다.
- 노션 동기화 API 엔드포인트가 증분 수집을 수행하며, 마지막 동기화 시간과 현재 수집 결과(문서 수, 청크 수)를 응답에 포함하도록 수정했다.
- 서버 로컬 타임존을 자동으로 감지하고, 마지막 동기화 시각이 naive datetime으로 저장된 경우 UTC 기준으로 정규화한 뒤 노션의 `last_edited_time`과 비교하도록 공통 유틸리티를 도입했다.

## 향후 작업
- 마지막 동기화 타임스탬프를 지속적으로 누적/보정할 수 있도록 영속 저장소 구조를 점검한다.
- 페이지 삭제/보관 등으로 인해 더 이상 존재하지 않는 컨텐츠를 백터 DB에서 정리하는 정합성 검증 루틴을 추가한다.