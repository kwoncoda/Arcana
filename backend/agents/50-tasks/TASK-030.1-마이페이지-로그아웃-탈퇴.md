---
id: TASK-MYPAGE-LOGOUT-DELETION
category: fullstack
status: done
title: "마이페이지 로그아웃/회원탈퇴 구현"
updated: 2025-10-04
artifacts:
  - code: frontend/my-react-app/src/components/MyPage.jsx
  - code: backend/routers/users.py
  - doc: backend/agents/40-stories/US-006.1-마이페이지-로그아웃-탈퇴.md
relates_to: ["US-004.1"]
---

## 요청 사항
- 마이페이지에서 로그아웃 시 프론트엔드 저장소의 액세스/리프레시 토큰을 모두 삭제하고 로그인 화면으로 이동해야 한다.
- 회원탈퇴 버튼을 누르면 백엔드에서 실제 탈퇴 로직이 수행되어야 하며, 프론트엔드에서는 성공 시 세션을 정리하고 로그인 화면으로 이동해야 한다.

## 접근 방식
- 프론트엔드: 공통 클라이언트를 활용해 `/api/users/me` DELETE 호출을 추가하고, 토큰/닉네임 저장소를 모두 정리하는 헬퍼를 마이페이지에 통합한다.
- 백엔드: 워크스페이스 유형별로 트랜잭션에서 정리한다. personal은 데이터 소스/연계 테이블·RAG 인덱스·워크스페이스를 삭제하고 스토리지까지 정리하며, organization은 멤버십 및 노션/구글 연동 정보만 제거한다.

## 진행 로그
- 2025-10-02: 요구사항 분석 및 관련 문서 검토, 프론트/백엔드 수정 범위 확정 후 구현 진행 중.
- 2025-10-02: 마이페이지 로그아웃/회원탈퇴 UI 동작 구현, `/users/me` 탈퇴 엔드포인트 추가, 시나리오 문서 정리 완료.
- 2025-10-03: 회원탈퇴 로직을 personal/organization 분기 기반 트랜잭션 삭제로 강화하고 워크스페이스 스토리지 정리를 포함시킴.
- 2025-10-04: organization 사용자일 때만 멤버십/조직 정리를 수행하고 중복된 구글 OAuth 삭제를 제거, 조직 워크스페이스는 유지하도록 재조정.
- 2025-10-05: 조직이 비어 있어도 Organization/워크스페이스를 삭제하지 않도록 조직 사용자 탈퇴 흐름을 정제.
- 2025-10-06: 탈퇴 요청이 500으로 실패하던 personal 사용자 사례에 맞춰 단일 커밋 기반 트랜잭션으로 정리하고 예외 로깅을 추가해 안정화.
- 2025-10-07: 삭제 전 과정을 트랜잭션 블록으로 재구성하고, 프론트엔드에 "탈퇴되었습니다" 전용 메시지를 노출한 뒤 로그인 화면으로 이동하도록 UX를 조정.
