---
id: TASK-0015.3
type: task
title: RAG 검색 시 텍스트-포맷 분리 및 포맷 컨텍스트 유지
status: done
owner: backend
updated: 2025-10-27
---

## 요청 사항
- RAG 검색에서 유사도 평가는 마크다운 주석이 제거된 순수 텍스트만을 대상으로 수행합니다.
- 검색 결과 컨텍스트와 시트레이션에는 노션 마크다운 포맷을 유지한 문자열을 사용합니다.
- JSONL 및 LangChain 문서에 포맷/텍스트 양쪽을 모두 저장하여 후속 생성형 작업이 포맷을 참고할 수 있게 합니다.

## 진행 기록
- 2025-10-27: `ragTransform` 청킹 로직을 확장해 포맷 마크다운과 plain 텍스트를 동시에 수집하도록 수정했습니다.
- 2025-10-27: JSONL 레코드와 문서 메타데이터에 `plain_text`와 `formatted_text`를 추가하고, 임베딩에는 plain 텍스트만 사용하도록 변경했습니다.
- 2025-10-27: RAG 검색 에이전트 컨텍스트/시트레이션 빌더가 `formatted_text`를 우선 사용하도록 조정했습니다.

## 결과
- Chroma 임베딩은 마크다운 메타 토큰이 제거된 텍스트에 기반해 계산되어 검색 정확도가 향상됩니다.
- 검색 결과 컨텍스트와 스니펫은 노션 마크다운 포맷을 유지해 문서 생성 시 기존 기획서 포맷을 참고할 수 있습니다.
- JSONL 응답에는 `plain_text` 필드가 추가되어 외부 시스템에서도 포맷과 원문을 구분해 활용할 수 있습니다.
